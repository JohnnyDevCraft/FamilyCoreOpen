@using System
@using System.Linq.Expressions
@using System.Threading.Tasks
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Forms

<div class="mb-4">
  <label class="block text-sm mb-1 text-[color:var(--color-text-muted-dark)]">@LabelText</label>
  <InputNumber TValue="decimal?" Value="Value" ValueChanged="OnInternalChanged" ValueExpression="ValueExpression"
               class="w-full px-3 py-2 rounded-md border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[color:var(--color-primary-400)]"
               step="@StepString"
               placeholder="@PlaceholderText"
               disabled="@Disabled" />
</div>

@code {
    [Parameter] public string LabelText { get; set; } = "";
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string PlaceholderText { get; set; } = "";
    [Parameter] public int Precision { get; set; } = 2;

    [Parameter] public decimal? Value { get; set; }
    [Parameter] public EventCallback<decimal?> ValueChanged { get; set; }
    [Parameter] public Expression<Func<decimal?>> ValueExpression { get; set; }

    string StepString => Precision <= 0 ? "1" : $"0.{new string('0', Math.Max(0, Precision - 1))}1";

    Task OnInternalChanged(decimal? newValue)
    {
        if (newValue.HasValue && Precision >= 0)
        {
            newValue = Math.Round(newValue.Value, Precision, MidpointRounding.AwayFromZero);
        }

        Value = newValue;
        return ValueChanged.InvokeAsync(Value);
    }
}
