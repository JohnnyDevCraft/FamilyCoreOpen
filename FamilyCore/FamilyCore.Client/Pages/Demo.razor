@page "/demo"

<PageTitle>Demo</PageTitle>
@rendermode InteractiveAuto
@using FamilyCore.Client.Components.Widget.Shared

<div class="flex flex-col gap-3 justify-start items-start w-full">
  <!-- Controls -->
  <div class="flex items-center justify-between mb-6 w-full">
    <h2 class="text-2xl font-semibold font-[var(--font-heading)]">Theme Playground</h2>
    <div class="flex items-center space-x-3">
      <ThemedButton Color="ThemeColor.Accent1"
                    Variant="ButtonVariant.Solid"
                    Size="ButtonSize.Small"
                    AdditionalClasses="px-3 text-sm"
                    OnClick="ToggleLogin">
        @if (IsLoggedIn) { <span>Switch to Public</span> } else { <span>Switch to App</span> }
      </ThemedButton>
      <span class="text-sm text-[color:var(--color-text-muted-dark)]">Logged in: <strong>@IsLoggedIn</strong></span>
    </div>
  </div>

  <!-- Navbars -->
  <NavbarPublic />
  <NavbarApp UserName="@UserName"
             UserEmail="@UserEmail"
             UserAvatarUrl="@UserAvatarUrl"
             NotificationCount="3"
             OnLogout="Logout"
             OnProfile="OpenProfile"
             OnSwitchFamily="SwitchFamily" />

  <!-- Panels demo: show different background token panels -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <ThemePanel ColorType="ThemeColor.Primary">
      <Header>
        <TitleGroup Title="Primary Modal" Subtitle="Panel for Testing Primary Theme" Color="ThemeColor.Primary"/>
      </Header>
      <ChildContent>
        <p>Uses --color-bg-primary</p>
      </ChildContent>
      <Footer><span>Token: var(--color-bg-primary)</span></Footer>
    </ThemePanel>

    <ThemePanel ColorType="ThemeColor.Secondary">
      <Header>
        <div class="flex flex-row justify-start items-center">
          <h2 class="text-2xl font-heading-bold">Secondary Panel</h2>
        </div>
      </Header>
      <ChildContent>
        <p>Uses --color-bg-secondary</p>
      </ChildContent>
      <Footer><span>Token: var(--color-bg-secondary)</span></Footer>
    </ThemePanel>
  
    <ThemePanel ColorType="ThemeColor.Tertiary">
      <Header>
        <div class="flex flex-row justify-start items-center">
          <h2 class="text-2xl font-heading-bold">Tertiary Panel</h2>
        </div>
      </Header>
      <ChildContent>
        <p>Uses --color-bg-tertiary</p>
      </ChildContent>
      <Footer><span>Token: var(--color-bg-tertiary)</span></Footer>
    </ThemePanel>
  
    <ThemePanel ColorType="ThemeColor.Accent1">
      <Header>
        <div class="flex flex-row justify-start items-center">
          <h2 class="text-2xl font-heading-bold">Accent1 Panel</h2>
        </div>
      </Header>
      <ChildContent>
        <p>Uses --color-bg-accent1</p>
      </ChildContent>
      <Footer><span>Token: var(--color-bg-accent1)</span></Footer>
    </ThemePanel>
    
    <ThemePanel ColorType="ThemeColor.Accent2">
      <Header>
        <div class="flex flex-row justify-start items-center">
          <h2 class="text-2xl font-heading-bold">Accent2 Panel</h2>
        </div>
      </Header>
      <ChildContent>
        <p>Uses --color-bg-accent2</p>
      </ChildContent>
      <Footer><span>Token: var(--color-bg-accent2)</span></Footer>
    </ThemePanel>
  
  </div>

  <!-- Modal Demo -->
  <ThemePanel>
    <Header>
      <TitleGroup Title="Themed Modal Variants" Subtitle="Open Modals styled with the same background tokens."/>
    </Header>
    <ChildContent>
      <div class="flex flex-wrap gap-2">
        <ThemedButton Color="ThemeColor.Primary" OnClick="@(() => OpenModal(ModalPrimary))">Primary Modal</ThemedButton>
        <ThemedButton Color="ThemeColor.Secondary" OnClick="@(() => OpenModal(ModalSecondary))">Secondary Modal</ThemedButton>
        <ThemedButton Color="ThemeColor.Tertiary" OnClick="@(() => OpenModal(ModalTertiary))">Tertiary Modal</ThemedButton>
        <ThemedButton Color="ThemeColor.Accent1" OnClick="@(() => OpenModal(ModalAccent1))">Accent 1 Modal</ThemedButton>
        <ThemedButton Color="ThemeColor.Accent2" OnClick="@(() => OpenModal(ModalAccent2))">Accent 2 Modal</ThemedButton>
      </div>
    </ChildContent>
    
  </ThemePanel>

<!-- Form Panel -->
<div class="p-6 rounded-md shadow mb-6 bg-white">
  <h3 class="text-lg font-semibold mb-4 font-[var(--font-heading)]">Themed Form (Widgets Preview)</h3>

  <EditForm Model="@Model" OnValidSubmit="HandleValidSubmit" class="max-w-2xl">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="space-y-4">
      <TextEdit @bind-Value="Model.FullName" LabelText="Full name" PlaceholderText="Jane Doe" />
      <PhoneEdit @bind-Value="Model.Phone" LabelText="Phone" PlaceholderText="(999)999-9999" />
      <EmailEdit @bind-Value="Model.Email" LabelText="Email" PlaceholderText="email@example.com" />
      <UrlEdit @bind-Value="Model.Website" LabelText="Website" PlaceholderText="https://..." />

      <DropDown @bind-Value="Model.Role" LabelText="Role" Options="RoleOptions" />
      <CheckBox @bind-Value="Model.Subscribe" LabelText="Subscribe to updates" />
      <RadioSelect @bind-Value="Model.PreferredContact" LabelText="Preferred contact" Options="ContactOptions" />

      <LongTextEdit @bind-Value="Model.Notes" LabelText="Notes" PlaceholderText="Any additional notes..." />

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <CurrencyBox @bind-Value="Model.Balance" LabelText="Balance" />
        <PercentBox @bind-Value="Model.Discount" LabelText="Discount" />
        <NumberBox @bind-Value="Model.Quantity" LabelText="Quantity" Precision="0" />
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <DateEditor @bind-Value="Model.BirthDate" LabelText="Birth date" />
        <DateTimeEditor @bind-Value="Model.NextAppointment" LabelText="Next appointment" />
        <TimeEditor @bind-Value="Model.PreferredTime" LabelText="Preferred time" />
      </div>

      <div class="pt-2">
        <ThemedButton Type="submit" Color="ThemeColor.Primary">Save</ThemedButton>
        <ThemedButton Type="button" Variant="ButtonVariant.Outline" Color="ThemeColor.Primary" AdditionalClasses="ml-3" OnClick="ResetForm">Reset</ThemedButton>
      </div>
    </div>
  </EditForm>
</div>

<!-- Tables Panel -->
<div class="p-6 rounded-md shadow mb-6 bg-white">
  <h3 class="text-lg font-semibold mb-4 font-[var(--font-heading)]">Themed Tables</h3>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <div class="border border-[color:var(--color-border)] rounded-md">
      <div class="px-4 pt-3 pb-2 text-sm font-medium text-[color:var(--color-text-muted-dark)]">Header row • not striped</div>
      <table class="w-full text-sm border-collapse border border-[color:var(--color-border)]">
        <thead class="bg-[color:var(--color-bg-primary-muted)] text-[color:var(--color-text-strong)]">
          <tr>
            <th class="text-left px-3 py-2 border border-[color:var(--color-border)]">Family</th>
            <th class="text-left px-3 py-2 border border-[color:var(--color-border)]">Status</th>
            <th class="text-right px-3 py-2 border border-[color:var(--color-border)]">Members</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Johnson</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Active</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">5</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Chavez</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Invited</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">3</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Patel</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Paused</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">4</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="border border-[color:var(--color-border)] rounded-md">
      <div class="px-4 pt-3 pb-2 text-sm font-medium text-[color:var(--color-text-muted-dark)]">Header row • striped</div>
      <table class="w-full text-sm border-collapse border border-[color:var(--color-border)]">
        <thead class="bg-[color:var(--color-bg-secondary)] text-[color:var(--color-text-strong)]">
          <tr>
            <th class="text-left px-3 py-2 border border-[color:var(--color-border)]">Program</th>
            <th class="text-left px-3 py-2 border border-[color:var(--color-border)]">Lead</th>
            <th class="text-right px-3 py-2 border border-[color:var(--color-border)]">Enrolled</th>
          </tr>
        </thead>
        <tbody class="text-[color:var(--color-text-muted-dark)]">
          <tr class="odd:bg-white even:bg-[color:var(--color-bg-primary-muted)]">
            <td class="px-3 py-2 border border-[color:var(--color-border)]">After School</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Jamie</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">28</td>
          </tr>
          <tr class="odd:bg-white even:bg-[color:var(--color-bg-primary-muted)]">
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Weekend Meals</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Morgan</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">64</td>
          </tr>
          <tr class="odd:bg-white even:bg-[color:var(--color-bg-primary-muted)]">
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Tutoring</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)]">Dee</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">19</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="border border-[color:var(--color-border)] rounded-md">
      <div class="px-4 pt-3 pb-2 text-sm font-medium text-[color:var(--color-text-muted-dark)]">Header row & header column • striped</div>
      <table class="w-full text-sm border-collapse border border-[color:var(--color-border)]">
        <thead class="bg-[color:var(--color-bg-tertiary)] text-[color:var(--color-text-strong)]">
          <tr>
            <th class="text-left px-3 py-2 border border-[color:var(--color-border)]">Month</th>
            <th class="text-right px-3 py-2 border border-[color:var(--color-border)]">Events</th>
            <th class="text-right px-3 py-2 border border-[color:var(--color-border)]">Attendance</th>
          </tr>
        </thead>
        <tbody class="text-[color:var(--color-text-muted-dark)]">
          <tr class="odd:bg-white even:bg-[color:var(--color-bg-primary-muted)]">
            <th scope="row" class="px-3 py-2 border border-[color:var(--color-border)] text-left bg-[color:var(--color-bg-accent-1)] text-[color:var(--color-text-strong)]">January</th>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">12</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">320</td>
          </tr>
          <tr class="odd:bg-white even:bg-[color:var(--color-bg-primary-muted)]">
            <th scope="row" class="px-3 py-2 border border-[color:var(--color-border)] text-left bg-[color:var(--color-bg-accent-1)] text-[color:var(--color-text-strong)]">February</th>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">9</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">255</td>
          </tr>
          <tr class="odd:bg-white even:bg-[color:var(--color-bg-primary-muted)]">
            <th scope="row" class="px-3 py-2 border border-[color:var(--color-border)] text-left bg-[color:var(--color-bg-accent-1)] text-[color:var(--color-text-strong)]">March</th>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">15</td>
            <td class="px-3 py-2 border border-[color:var(--color-border)] text-right">410</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

  <!-- Buttons Panel -->
  <div class="p-6 rounded-md shadow mb-6 bg-white">
    <h3 class="text-lg font-semibold mb-4 font-[var(--font-heading)]">Button Variants</h3>
    <div class="flex flex-wrap gap-3 items-center">
      <ThemedButton Variant="ButtonVariant.Solid" Color="ThemeColor.Primary">Primary</ThemedButton>
      <ThemedButton Variant="ButtonVariant.Outline" Color="ThemeColor.Primary">Outline</ThemedButton>
      <ThemedButton Variant="ButtonVariant.Ghost" Color="ThemeColor.Primary">Ghost</ThemedButton>

      <ThemedButton Variant="ButtonVariant.Solid" Color="ThemeColor.Secondary" Size="ButtonSize.Large" AdditionalClasses="ml-4">Large</ThemedButton>
      <ThemedButton Variant="ButtonVariant.Solid" Color="ThemeColor.Tertiary" Size="ButtonSize.Small">Small</ThemedButton>

      <ThemedButton Variant="ButtonVariant.Solid" Color="ThemeColor.Primary" Disabled="true">Disabled</ThemedButton>
    </div>
  </div>
</div>

<ThemedModal IsOpen="@IsModalOpen"
             ColorType="@GetModalColor()" AllowCancel="true" Title="@GetModalTitle()" Subtitle="This is a modal preview">

  <p class="mb-3">This modal uses the <strong>@(ActiveModalTheme?.ToUpperInvariant())</strong> background token to preview overlay styling.</p>
  <ul class="list-disc list-inside space-y-1 text-sm">
    <li>Backdrop closes on click.</li>
    <li>Top-right close button.</li>
    <li>Footer actions for confirmation.</li>
  </ul>
</ThemedModal>

@code {
    // Toggle to preview public vs in-app states; adapt later to real auth.
    bool IsLoggedIn { get; set; } = false;

    string UserName { get; set; } = "Alex Johnson";
    string UserEmail { get; set; } = "alex.johnson@example.com";
    string UserAvatarUrl { get; set; } = "/images/logo-icon.png";

    void ToggleLogin()
    {
        IsLoggedIn = !IsLoggedIn;
    }

    void Logout()
    {
        IsLoggedIn = false;
    }

    void OpenProfile()
    {
        Console.WriteLine("Profile clicked");
    }

    void SwitchFamily()
    {
        Console.WriteLine("Switch Family clicked");
    }

    // --- Form model & demo data for widgets preview ---
    FormModel Model { get; set; } = new FormModel();

    Dictionary<string, object> RoleOptions { get; set; } = new Dictionary<string, object>
    {
        { "Parent", "parent" },
        { "Volunteer", "volunteer" },
        { "Staff", "staff" }
    };

    Dictionary<string, object> ContactOptions { get; set; } = new Dictionary<string, object>
    {
        { "Email", "email" },
        { "Phone", "phone" }
    };

    void HandleValidSubmit()
    {
        // quick visual confirm — expand later
        Console.WriteLine($"Saved: {Model.FullName} / {Model.Email}");
    }

    void ResetForm()
    {
        Model = new FormModel();
    }

    // --- Modal demo state ---
    string ActiveModalTheme { get; set; }
    bool IsModalOpen => !string.IsNullOrWhiteSpace(ActiveModalTheme);

    readonly Dictionary<string, (string Title, ThemeColor Color)> ModalThemes =
        new()
        {
            [ModalPrimary] = ("Primary Modal", ThemeColor.Primary),
            [ModalSecondary] = ("Secondary Modal", ThemeColor.Secondary),
            [ModalTertiary] = ("Tertiary Modal", ThemeColor.Tertiary),
            [ModalAccent1] = ("Accent 1 Modal", ThemeColor.Accent1),
            [ModalAccent2] = ("Accent 2 Modal", ThemeColor.Accent2),
        };

    const string ModalPrimary = "primary";
    const string ModalSecondary = "secondary";
    const string ModalTertiary = "tertiary";
    const string ModalAccent1 = "accent1";
    const string ModalAccent2 = "accent2";

    void OpenModal(string themeKey)
    {
        ActiveModalTheme = themeKey;
    }

    void CloseModal()
    {
        ActiveModalTheme = null;
    }

    string GetModalTitle()
    {
        return ModalThemes.TryGetValue(ActiveModalTheme ?? string.Empty, out var info) ? info.Title : "Modal";
    }

    ThemeColor GetModalColor()
    {
        return ModalThemes.TryGetValue(ActiveModalTheme ?? string.Empty, out var info) ? info.Color : ThemeColor.Primary;
    }

    class FormModel
    {
        public string FullName { get; set; }
        public string Phone { get; set; }
        public string Email { get; set; }
        public string Website { get; set; }
        public string Role { get; set; }
        public bool Subscribe { get; set; }
        public string PreferredContact { get; set; }
        public string Notes { get; set; }

        public decimal? Balance { get; set; }
        public decimal? Discount { get; set; } // stored as fraction (0.15 = 15%)
        public decimal? Quantity { get; set; }

        public DateTime? BirthDate { get; set; }
        public DateTime? NextAppointment { get; set; }
        public TimeSpan? PreferredTime { get; set; }
    }
}
