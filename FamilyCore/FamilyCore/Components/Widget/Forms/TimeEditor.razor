@using System
@using System.Globalization
@using System.Linq.Expressions
@using System.Threading.Tasks
@using Microsoft.AspNetCore.Components

<div class="mb-4">
  <label class="block text-sm mb-1 text-[color:var(--color-text-muted-dark)]">@LabelText</label>
  <input type="time"
         class="w-full px-3 py-2 rounded-md border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[color:var(--color-primary-400)]"
         value="@DisplayValue"
         placeholder="@PlaceholderText"
         disabled="@Disabled"
         @oninput="OnInputAsync" />
</div>

@code {
    [Parameter] public string LabelText { get; set; } = "";
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string PlaceholderText { get; set; } = "";

    [Parameter] public TimeSpan? Value { get; set; }
    [Parameter] public EventCallback<TimeSpan?> ValueChanged { get; set; }
    [Parameter] public Expression<Func<TimeSpan?>> ValueExpression { get; set; }

    string DisplayValue => Value.HasValue ? Value.Value.ToString(@"hh\:mm") : "";

    async Task OnInputAsync(ChangeEventArgs e)
    {
        var raw = e.Value?.ToString() ?? "";
        if (string.IsNullOrWhiteSpace(raw))
        {
            Value = null;
            await ValueChanged.InvokeAsync(null);
            return;
        }

        if (TimeSpan.TryParseExact(raw, @"hh\:mm", CultureInfo.InvariantCulture, out var parsed))
        {
            Value = parsed;
            await ValueChanged.InvokeAsync(parsed);
        }
    }
}
